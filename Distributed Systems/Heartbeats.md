## Premise

In a distributed system, things fail.

Hardware malfunctions, software crashes, or network connections drop.

Whether you're watching your favorite show online, making an online purchase, or checking your bank balance, you're relying on a complex network of interconnected services.

But, how do we know if a particular service is alive and working as expected?

This is where **heartbeats** come into play.

## What is a heartbeat ?

> In distributed systems, a Heartbeat is a **periodic signal** generated by hardware/software to **indicate** **normal operation** or to synchronize other parts of a computer system. 

Its primary purpose is to signal, **"Hey, I'm still here and working!"**

It is a common technique to detect network or system failures of nodes/daemons which belong to a network cluster.

**Function**:
1. Ensure High availability and Fault tolerance of network services
2. Part of Automatic adaptation rebalancing of system by using remaining nodes to take over load of failed modes. 

![[Pasted image 20240505225131.png]]

Usually a heartbeat is sent between machines at a regular interval in the order of seconds; a heartbeat message.

If the endpoint does not receive a heartbeat for a time—usually a few heartbeat intervals—the machine that should have sent the heartbeat is assumed to have failed.

Heartbeat messages are typically sent non-stop on a periodic or recurring basis from the originator's start-up until the originator's shutdown. 

When the destination identifies a lack of heartbeat messages during an anticipated arrival period, the destination may determine that the originator has failed, shutdown, or is generally no longer available.

## Protocols

### Small Clusters: Consensus based implementation

![[Leader_follower_hb.excalidraw.svg]]

Heartbeats are sent from the leader server to all follower servers. Every time a heartbeat is received, the timestamp of heartbeat arrival is recorded. 

If no heartbeat is received in a fixed time window, the leader is considered crashed, and a new server among the followers is elected as a leader. 

There are chances of false failure detection because of slow processes or networks. So Generation Clock needs to be used to detect the stale leader. This provides better availability of the system, as crashes are detected in smaller time periods. 

This is **suitable for smaller clusters**, **typically 3 to 5 node setup** which is observed in most consensus implementations like Zookeeper or Raft.
### Large Clusters: Gossip Based Protocols




## Overview of mechanisms

![[1710258047533.gif ]]




